---
title: "Bacterial traits and human disease outcomes"
author: "Ilya"
date: "12/7/2018"
output: github_document
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

####To do:
Add code reading in GIDEON data from other Rmd file. 

##Strategy
Integrate data on host species, pathogen species, pathogen traits, and human disease outcomes. 

Apply generalized boosted models (GBM) to predict human disease outcomes based on bacterial traits. 

##Data sources
1. GIDEON dataset of ungulate hosts and zoonotic diseases
2. Dataset relating mammals to pathogens (GMPD)
3. Bacterial trait datasets (Brbic et al. 2016; Barberan et al. 2017) 
4. Human disease outcomes (GIDEON): case fatality rates, outbreak size, prevalence 5. Ungulate host ranges (IUCN)

##Study design

####install and load required packages
```{r packages, echo=FALSE}
source("packages_bacteria.R")
```

###Data: Global Mammal Parasite Database

###Mammal pathogen data
####read in GMPD and save
check out taxonomy dataset 
```{r}
source("GMPD.R")
```


###Data: bacterial traits

####Bacterial traits: read in and save Brbic et al. 2016 
Source: ProTraits: http://protraits.irb.hr/data.html. 
We are using version of data in which traits have been binarized. 
Read in data and save as p1.Rdata. 
```{r read_data_pathogen_traits1}
source("read_data_pathogen_traits1.R")
```

####Bacterial traits: correct taxonomy in Brbic et al. 2016 data
Output data to file (species.csv) to upload to NCBI website (https://www.ncbi.nlm.nih.gov/Taxonomy/TaxIdentifier/tax_identifier.cgi). After running taxonomy_ncbi.R, go to NCBI website, upload species.csv, and choose option to save to file from website. Save file to working directory. 
```{r taxonomy_ncbi}
source("taxonomy_ncbi.R")
```

Read back in file outputted from NCBI website ("tax_report.txt"). Merge tax_report.txt with p1 (original Brbic et al. data), with new field "preferred.name"
```{r taxonomy_ncbi_out}
source("taxonomy_ncbi_out.R")
```

Also attempted, didn't work: Attempted with R package taxize fxn synonyms and "col" (Catalog of Life). Note: taxize does not include NCBI. This requires a lot of interaction for species with multiple matches.  
```{r}
# source("taxonomy1.R")
```

Also attempted, didn't work: Attempted with R package myTAI. This option requires interaction while code is looping through species, for species with more than one entry in NCBI.  
```{r}
# source("taxonomy_p1_myTAI.R")
```

####Bacterial traits: determine correlations among variables in Brbic et al. 2016. 
Note: commenting out corrplot for now because it throws an error. 
```{r}
# source("corrplot_bacteria.R")
```


####Bacterial traits: Read in data in Barberan et al. 2017 and save as p2.Rdata
Source: https://figshare.com/articles/International_Journal_of_Systematic_and_Evolutionary_Microbiology_IJSEM_phenotypic_database/4272392
```{r ijsem}
source("read_data_pathogen_traits2.R")
```


####Bacterial traits: correct taxonomy in Barberan et al. 2017 data
output file as species2.csv. make field Organism_name. Some species have multiple entries. There is no explanation about this (https://figshare.com/articles/International_Journal_of_Systematic_and_Evolutionary_Microbiology_IJSEM_phenotypic_database/4272392). Executive decision: filter data so that there are only records for species with one line of data, because these are data in which we have most confidence.   
After running taxonomy_ncbi_2.R, go to NCBI website, upload species.csv, and choose option to save to file from website. Save file to working directory. 
```{r}
source("taxonomy_ncbi_2.R")
```

Read back in file outputted from NCBI website ("tax_report2.txt"). Merge tax_report.txt with p2 (original Barberan et al. data), with new field "preferred.name"
```{r taxonomy_ncbi_out2}
source("taxonomy_ncbi_out2.R")
```

####Bacterial traits: determine overlap between species in GMPD and each trait database
```{r}
source("GMPD_pathogen.R")
```



####find species in common between  Brbic et al. (p1) and Barberan et al. 
```{r}
source("common_p.R")
```

